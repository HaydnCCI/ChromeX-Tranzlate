var isoLangs={af:{name:"Afrikaans",nativeName:"Afrikaans"},sq:{name:"Albanian",nativeName:"Shqip"},am:{name:"Amharic",nativeName:"\u12a0\u121b\u122d\u129b"},ar:{name:"Arabic",nativeName:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629"},hy:{name:"Armenian",nativeName:"\u0540\u0561\u0575\u0565\u0580\u0565\u0576"},az:{name:"Azerbaijani",nativeName:"az\u0259rbaycan dili"},eu:{name:"Basque",nativeName:"euskara"},be:{name:"Belarusian",nativeName:"\u0411\u0435\u043b\u0430\u0440\u0443\u0441\u043a\u0430\u044f"},
bn:{name:"Bengali",nativeName:"\u09ac\u09be\u0982\u09b2\u09be"},bs:{name:"Bosnian",nativeName:"bosanski jezik"},bg:{name:"Bulgarian",nativeName:"\u0431\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438 \u0435\u0437\u0438\u043a"},ca:{name:"Catalan",nativeName:"Catal\u00e0"},ceb:{name:"Cebuano",nativeName:"Bisaya"},ny:{name:"Chichewa",nativeName:"chiChe\u0175a"},zh:{name:"Chinese",nativeName:"\u4e2d\u6587 (Zh\u014dngw\u00e9n)"},co:{name:"Corsican",nativeName:"corsu"},hr:{name:"Croatian",nativeName:"hrvatski"},
cs:{name:"Czech",nativeName:"\u010desky"},da:{name:"Danish",nativeName:"dansk"},nl:{name:"Dutch",nativeName:"Nederlands"},en:{name:"English",nativeName:"English"},eo:{name:"Esperanto",nativeName:"Esperanto"},et:{name:"Estonian",nativeName:"eesti"},tl:{name:"Filipino",nativeName:"Pilipino"},fi:{name:"Finnish",nativeName:"suomi"},fr:{name:"French",nativeName:"fran\u00e7ais"},fy:{name:"Frisian",nativeName:"Frysk"},gl:{name:"Galician",nativeName:"Galego"},ka:{name:"Georgian",nativeName:"\u10e5\u10d0\u10e0\u10d7\u10e3\u10da\u10d8"},
de:{name:"German",nativeName:"Deutsch"},el:{name:"Greek",nativeName:"\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac"},gu:{name:"Gujarati",nativeName:"\u0a97\u0ac1\u0a9c\u0ab0\u0abe\u0aa4\u0ac0"},ht:{name:"Haitian Creole",nativeName:"Krey\u00f2l ayisyen"},ha:{name:"Hausa",nativeName:"Hausa"},haw:{name:"Hawaiian",nativeName:"Hausa"},iw:{name:"Hebrew",nativeName:"\u05e2\u05d1\u05e8\u05d9\u05ea"},hi:{name:"Hindi",nativeName:"\u0939\u093f\u0928\u094d\u0926\u0940, \u0939\u093f\u0902\u0926\u0940"},hmn:{name:"Hmong",
nativeName:"lus Hmoob"},hu:{name:"Hungarian",nativeName:"Magyar"},is:{name:"Icelandic",nativeName:"\u00cdslenska"},ig:{name:"Igbo",nativeName:"As\u1ee5s\u1ee5 Igbo"},id:{name:"Indonesian",nativeName:"Bahasa Indonesia"},ga:{name:"Irish",nativeName:"Gaeilge"},it:{name:"Italian",nativeName:"Italiano"},ja:{name:"Japanese",nativeName:"\u65e5\u672c\u8a9e (\u306b\u307b\u3093\u3054\uff0f\u306b\u3063\u307d\u3093\u3054)"},jv:{name:"Javanese",nativeName:"basa Jawa"},kn:{name:"Kannada",nativeName:"\u0c95\u0ca8\u0ccd\u0ca8\u0ca1"},
kk:{name:"Kazakh",nativeName:"\u049a\u0430\u0437\u0430\u049b \u0442\u0456\u043b\u0456"},km:{name:"Khmer",nativeName:"\u1797\u17b6\u179f\u17b6\u1781\u17d2\u1798\u17c2\u179a"},ko:{name:"Korean",nativeName:"\ud55c\uad6d\uc5b4 (\u97d3\u570b\u8a9e)"},ku:{name:"Kurdish (Kurmanji)",nativeName:"Kurd\u00ee"},ky:{name:"Kyrgyz",nativeName:"\u043a\u044b\u0440\u0433\u044b\u0437 \u0442\u0438\u043b\u0438"},lo:{name:"Lao",nativeName:"\u0e9e\u0eb2\u0eaa\u0eb2\u0ea5\u0eb2\u0ea7"},la:{name:"Latin",nativeName:"latine"},
lv:{name:"Latvian",nativeName:"latvie\u0161u valoda"},lt:{name:"Lithuanian",nativeName:"lietuvi\u0173 kalba"},lb:{name:"Luxembourgish",nativeName:"L\u00ebtzebuergesch"},mk:{name:"Macedonian",nativeName:"\u043c\u0430\u043a\u0435\u0434\u043e\u043d\u0441\u043a\u0438 \u0458\u0430\u0437\u0438\u043a"},mg:{name:"Malagasy",nativeName:"Malagasy fiteny"},ms:{name:"Malay",nativeName:"bahasa Melayu"},ml:{name:"Malayalam",nativeName:"\u0d2e\u0d32\u0d2f\u0d3e\u0d33\u0d02"},mt:{name:"Maltese",nativeName:"Malti"},
mi:{name:"M\u0101ori",nativeName:"te reo M\u0101ori"},mr:{name:"Marathi",nativeName:"\u092e\u0930\u093e\u0920\u0940"},mn:{name:"Mongolian",nativeName:"\u043c\u043e\u043d\u0433\u043e\u043b"},my:{name:"Myanmar",nativeName:"\u1017\u1019\u102c\u1005\u102c"},ne:{name:"Nepali",nativeName:"\u0928\u0947\u092a\u093e\u0932\u0940"},no:{name:"Norwegian",nativeName:"Norsk"},ps:{name:"Pashto",nativeName:"\u067e\u069a\u062a\u0648"},fa:{name:"Persian",nativeName:"\u0641\u0627\u0631\u0633\u06cc"},pl:{name:"Polish",
nativeName:"polski"},pt:{name:"Portuguese",nativeName:"Portugu\u00eas"},pa:{name:"Punjabi",nativeName:"\u0a2a\u0a70\u0a1c\u0a3e\u0a2c"},ro:{name:"Romanian",nativeName:"rom\u00e2n\u0103"},ru:{name:"Russian",nativeName:"\u0440\u0443\u0441\u0441\u043a\u0438\u0439 \u044f\u0437\u044b\u043a"},sm:{name:"Samoan",nativeName:"gagana faa Samoa"},gd:{name:"Scots Gaelic",nativeName:"G\u00e0idhlig"},sr:{name:"Serbian",nativeName:"\u0441\u0440\u043f\u0441\u043a\u0438 \u0458\u0435\u0437\u0438\u043a"},st:{name:"Sesotho",
nativeName:"Sesotho"},sn:{name:"Shona",nativeName:"chiShona"},sd:{name:"Sindhi",nativeName:"\u0938\u093f\u0928\u094d\u0927\u0940"},si:{name:"Sinhala",nativeName:"\u0dc3\u0dd2\u0d82\u0dc4\u0dbd"},sk:{name:"Slovak",nativeName:"sloven\u010dina"},sl:{name:"Slovenian",nativeName:"sloven\u0161\u010dina"},so:{name:"Somali",nativeName:"Soomaaliga"},es:{name:"Spanish",nativeName:"espa\u00f1ol"},su:{name:"Sundanese",nativeName:"Basa Sunda"},sw:{name:"Swahili",nativeName:"Kiswahili"},sv:{name:"Swedish",nativeName:"svenska"},
tg:{name:"Tajik",nativeName:"\u0442\u043e\u04b7\u0438\u043a\u04e3"},ta:{name:"Tamil",nativeName:"\u0ba4\u0bae\u0bbf\u0bb4\u0bcd"},te:{name:"Telugu",nativeName:"\u0c24\u0c46\u0c32\u0c41\u0c17\u0c41"},th:{name:"Thai",nativeName:"\u0e44\u0e17\u0e22"},tr:{name:"Turkish",nativeName:"T\u00fcrk\u00e7e"},uk:{name:"Ukrainian",nativeName:"\u0443\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430"},ur:{name:"Urdu",nativeName:"\u0627\u0631\u062f\u0648"},uz:{name:"Uzbek",nativeName:"zbek"},vi:{name:"Vietnamese",
nativeName:"Ti\u1ebfng Vi\u1ec7t"},cy:{name:"Welsh",nativeName:"Cymraeg"},xh:{name:"Xhosa",nativeName:"isiXhosa"},yi:{name:"Yiddish",nativeName:"\u05d9\u05d9\u05b4\u05d3\u05d9\u05e9"},yo:{name:"Yoruba",nativeName:"Yor\u00f9b\u00e1"},za:{name:"Zhuang, Chuang",nativeName:"Sa\u026f cue\u014b\u0185"},zu:{name:"Zulu",nativeName:"isiZulu"}};

var selectedLanguage;

$('.topnav a').click(function () {
    document.getElementById("sideNavigation").style.width = "250px";
    document.getElementById("main").style.marginLeft = "250px";
});

$('.closebtn').click(function () {
    document.getElementById("sideNavigation").style.width = "0";
    document.getElementById("main").style.marginLeft = "0";
});

$('#toggle-event').change(function () {
    saveEnableToggle($(this).prop('checked'));
});

$("#translated_to").click(function(){ 
    document.getElementById("languages_add_dialog").showModal(); 
    print_list_modal();
    document.getElementById("select_language").focus(); 
});

$("#more").click(function(){ 
    chrome.tabs.create({url: 'http://www.wetranzlate.com'});
     return false; 
});

$("#contactus").click(function(){ 
    chrome.tabs.create({url: 'http://www.wetranzlate.com/aboutus.php'});
     return false; 
});

$("#donate").click(function(){ 
    chrome.tabs.create({url: 'https://paypal.me/wetranzlate'});
     return false; 
});

$("#footer").click(function(){ 
    chrome.tabs.create({url: 'https://chrome.google.com/webstore/detail/we-tranzlate-premium/olmbanehdhngpgkcfjmilomnnbikohbm?authuser=1'});
     return false; 
});

$("#recent_translation").click(function(){ 
    chrome.runtime.sendMessage({
        action: 'openHistory'
    });
});

$("#flashcards").click(function(){ 
    chrome.runtime.sendMessage({
        action: 'openFlashCards'
    });
});

$("#languages_add_cancel").click(function(){ 
    closeModal();
});

$("#languages_add_ok").click(function(){ 
    var language = document.getElementById("select_language").value;
    saveLanguage(language);
});

$("#select_language").change(function(){ 
    var language = document.getElementById("select_language").value;
    saveLanguage(language);
});

function saveEnableToggle(val) {
    chrome.storage.sync.set({enabled: val}, function () {
        updateIcon(val);
    });
}

function saveLanguage(val) {
    chrome.storage.sync.set({language: val}, function () {
        //closeModal();
        document.getElementById("select_language").parentElement.classList.add('highlight');
    });
}

function getLanguage() {
    chrome.storage.sync.get(['language'], function (result) {
        var lang = result.language; 
        if(!lang) {
            lang = 'en';
        }
        //document.getElementById("translated_to").innerHTML = isoLangs[lang]["name"] + " ("+isoLangs[lang]["nativeName"]+")";
        selectedLanguage = lang;
        print_list_modal();
    });
}

function loadEnableToggle() {
    chrome.storage.sync.get(['enabled'], function (result) {
        var isEnabled = result.enabled;

        if (isEnabled) {
            $('#toggle-event').bootstrapToggle('on');
        } else {
            $('#toggle-event').bootstrapToggle('off');
        }
        
        updateIcon(isEnabled);
    });
    //chrome.storage.sync.clear();
    //chrome.runtime.reload();
}

function updateIcon(val) {
    if (val === 'undefined') {
        return;
    }
    chrome.runtime.sendMessage({
        action: 'updateIcon',
        value: val
    });
}

function print_list_modal() {
    document.getElementById("select_language").innerHTML = "";
    for (var language in isoLangs) {
        var el = document.createElement('option');
        el.setAttribute('value', language);
        if(selectedLanguage == language) {
            el.selected = true;
        }
        el.innerText = isoLangs[language]["name"]+" ("+isoLangs[language]["nativeName"]+")";
        document.getElementById("select_language").appendChild(el);
    }
}

function getTranslationCounter() {
    chrome.storage.sync.get(['translationCounter'], function (result) {
        var count = result.translationCounter;
        var counter = 0;
        if(count) {
            counter = count;
        }
        document.getElementById("translation_counter").innerHTML = counter;
    });
}

function getTranslationHistoryCounter() {
    chrome.storage.local.get({translationHistory: []}, function (result) {
        var translationHistory = result.translationHistory;
        var counter = 0;
        if(translationHistory) {
            counter = translationHistory.length;
        }
        document.getElementById("translation_recent").innerHTML = counter;
    });
}

function getFlashCardsCount() {
    chrome.storage.local.get({flashCards: []}, function (result) {
        var flashCards = result.flashCards;
        var counter = 0;
        if(flashCards) {
            counter = flashCards.length;
        }
        document.getElementById("flashcard_counter").innerHTML = counter;
    });
}

function closeModal() {
    document.getElementById("languages_add_dialog").close();
    refresh();
}

function init() {
    loadEnableToggle();
    getLanguage();
    //getTranslationCounter();
    //getFlashCardsCount();
    //getTranslationHistoryCounter();
}

function refresh() {
    getLanguage();
}

window.addEventListener('load', init);